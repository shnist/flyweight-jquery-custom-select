!function(a){var b="ontouchstart"in document.documentElement?"touchend":"click";a.fn.flyweightCustomSelect=function(c){var d={},e=a.fn.flyweightCustomSelect.menu||null;c&&c.alignTo?c.alignTo:null;var f=function(){var c=null,f=!1,g=null,h=null,i=0,j=[],k=function(){j=a.map(a(d.optionfilter,c),function(b){var c=a(b),e=c[0].index;return a.browser.msie&&"OPTGROUP"===b.nodeName.toUpperCase()&&(e=null),{type:b.nodeName.toUpperCase(),selectIndex:e,text:d.htmlGenerator?d.itemHtmlGenerator.apply(c):c.text(),value:c.attr("value"),group:c.attr("label")}})},l=function(){for(var a=0,b='<ul class="'+d.classes.menu.list.base+'">',c=function(a,b){return'<li><a  class="'+d.classes.menu.listitem.base+'"data-index="'+a+'" href="#">'+b+"</a></li>"};a<j.length;)if("OPTGROUP"===j[a].type){for(b+='<li class="'+d.classes.menu.group.base+'"><span>'+j[a].group+"</span><ul>",a+=1;a<j.length&&"OPTGROUP"!==j[a].type;)b+=c(j[a].selectIndex,j[a].text),a+=1;b+="</ul></li>"}else b+=c(j[a].selectIndex,j[a].text),a+=1;g.html(b+"</ul>")},m=function(){var a=h.width();g.width(a)},n=function(){if(!h)return!1;var c=g.outerHeight(),e=h.offset().top,f=h.height(),i=window.innerHeight?window.innerHeight:a(window).height(),j=0,k=d.alignTo&&h.parents(d.alignTo).first()||null,l=k?k:h,m=k?Math.max(k.width(),h.width()):0,n=k?Math.min(k.width(),h.width()):0,p=k?m-n:0,q=!0;if(i>e+f+c)j=e+f;else if(e-c>a(window).scrollTop())j=e-c,q=!1;else{var r;j=e+f,r=Math.min(c,i-(j-a(window).scrollTop())),g.find("ul."+d.classes.menu.list.base).height(r),"touchend"===b&&o(c,r)}return g.css({left:l.offset().left+"px",top:j+"px",width:h.width()+p}),q},o=function(b,c){var e=a('<span class="'+d.classes.menu.scroll.base+'"></span>');e.height(parseInt(Math.pow(c,2)/b,10)-10),g.append(e)},p=function(b){c.value!==j[b].value&&(c.value=j[b].value,c.selectedIndex=j[b].selectIndex,a(c).trigger("change"))},q=function(a){var b;p(a),b=g.find('a[data-index="'+j[a].selectIndex+'"]'),g.find("ul").scrollTop(0),g.find("a").removeClass(d.classes.menu.listitem.focus),b.length>0&&(b.addClass(d.classes.menu.listitem.focus),g.find("ul").scrollTop(b.position().top))},r=function(a,b){for(var c=j.length-1;c>0&&j[c][a]!==b;)c-=1;return c},s=function(a,b){for(;b<c.options.length;){if(c[b].text.toUpperCase().charCodeAt(0)===a)return q(r("selectIndex",b)),!0;b+=1}return!1},t=function(a){return a=a.toUpperCase().charCodeAt(0),s(a,c.selectedIndex+1)||s(a,0)},u=function(a){a.stopPropagation();var b=a.target;return"A"!==b.nodeName.toUpperCase()?!1:(e.touchMoved||(p(r("selectIndex",parseInt(b.getAttribute("data-index"),10))),e.close(),h.focus()),!1)},v=function(a){return a.stopPropagation(),h.addClass(d.classes.placeholder.container.focus),e.touchMoved=!1,e.lastTouch=a.originalEvent.touches[0].pageY,!1},w=function(a){e.touchMoved=!0;var b=g.find("ul."+d.classes.menu.list.base),c=g.find("span."+d.classes.menu.scroll.base),f=b.attr("scrollTop")+e.lastTouch-a.originalEvent.touches[0].pageY,h=5+f*c.height()/b.height();h=Math.max(5,h),h=Math.min(b.height()-c.height()-10,h),b.scrollTop(f),c.css("top",h),e.lastTouch=a.originalEvent.touches[0].pageY},x=function(a){for(var b=j.length;b;)b-=1,j[b].selectIndex===c.selectedIndex+a&&(q(b),b=0)};return function(){return g=a('<div class="'+d.classes.menu.container.base+'" />'),g.bind(b,u),g.bind("touchstart",v),g.bind("touchmove",w),a("body").append(g),{bondToSelect:function(a,b){h=a,c=b},open:function(){return f?!1:(k(),l(),m(),n()?(g.addClass(d.classes.menu.container.dropdown),h.addClass(d.classes.placeholder.container.dropdown)):(g.addClass(d.classes.menu.container.dropup),h.addClass(d.classes.placeholder.container.dropup)),g.addClass(d.classes.menu.container.open),h.addClass(d.classes.placeholder.container.open).focus(),i=r("selectIndex",c.selectedIndex),q(i),f=!0)},close:function(){g.removeClass(d.classes.menu.container.open+" "+d.classes.menu.container.dropdown+" "+d.classes.menu.container.dropup),h&&(h.removeClass(d.classes.placeholder.container.open+" "+d.classes.placeholder.container.dropdown+" "+d.classes.placeholder.container.dropup),"touchend"===b&&(h[0].className=d.classes.placeholder.container.base)),f=!1},destroy:function(){g.unbind(),g.remove()},reset:function(){q(i),this.close()},isOpen:function(){return f},scrollDown:function(){this.open()||x(1)},scrollUp:function(){this.open()||x(-1)},pageDown:function(){this.open()||x(10)},pageUp:function(){this.open()||x(-10)},search:function(a){this.open(),t(a)},getSelect:function(){return c},getCurrentPlaceHolder:function(){return h},touchMoved:!1,lastTouch:0,reposition:n}}()},g=function(c){var f,g=function(){var a=function(a){return a.stopPropagation(),a.preventDefault(),e.bondToSelect(f,c),e.open()||e.close()};return"touchend"!==b?function(b){a(b)}:function(b){var c=e.getCurrentPlaceHolder();c&&(c[0].className=d.classes.placeholder.container.base),a(b)}}(),h=function(a){return a.stopPropagation(),!1},j=function(c){c.stopPropagation();var f=c.keyCode;switch((f===d.keymap.left||f===d.keymap.right||f===d.keymap.up||f===d.keymap.down||f===d.keymap.enter||f===d.keymap.space)&&c.preventDefault(),!0){case f===d.keymap.left:case f===d.keymap.up:e.scrollUp();break;case f===d.keymap.right:case f===d.keymap.down:e.scrollDown();break;case f===d.keymap.pgup:e.pageUp();break;case f===d.keymap.pgdn:e.pageDown();break;case f===d.keymap.enter:case f===d.keymap.space:a(this).trigger(b);break;case f===d.keymap.tab:e.close();break;case f===d.keymap.escape:e.reset();break;case f>=48&&59>=f:case f>=65&&90>=f:case f>=97&&122>=f:e.search(String.fromCharCode(f))}},k=function(a){a.stopPropagation(),e.bondToSelect(f,c),f.addClass(d.classes.placeholder.container.focus)},l=function(a){a.stopPropagation(),f[0].className=d.classes.placeholder.container.base},m=function(a){a.target.options&&f&&f.find("span."+d.classes.placeholder.text.base).html(a.target.options[a.target.selectedIndex].text)},n=function(){var e=function(){a(c).removeAttr("disabled"),a(c).attr("tabindex")&&d.tabindex?f.attr("tabindex",a(c).attr("tabindex")):f.attr("tabindex",0),f.removeClass(d.classes.placeholder.container.disabled),f.bind(b,g)};return"touchend"!==b?function(){e(),f.unbind("focus").bind("focus",k),f.unbind("blur").bind("blur",l),f.keydown(j)}:function(){e(),f.unbind("touchstart").bind("touchstart",h)}}(),o=function(){var e=function(){a(c).attr("disabled","disabled"),!d.tabindex||f.removeAttr("tabindex"),f.addClass(d.classes.placeholder.container.disabled),f.unbind(b).bind(b,function(){return!1})};return"touchend"!==b?function(){e(),f.unbind("focus").bind("focus",function(){return this.blur(),!1}),f.unbind("blur"),f.unbind("keydown")}:function(){e(),f.unbind("touchstart")}}();return function(){return f=i(c),n(),a(c).after(f),a(c).hide(),a(c).bind("change",m),{enable:function(){n()},disable:function(){o()},destroy:function(){f.unbind(),f.remove(),a(c).removeAttr("disabled").show()}}}()},h={init:function(c){var h=function(){if("touchend"!==b)return function(){e.isOpen()&&e.reset()};var c;return a(document).bind("touchstart",function(){c=!1}),a(document).bind("touchmove",function(){c=!0}),function(){e.isOpen()&&c===!1&&e.reset()}}();return d=a.extend({},a.fn.flyweightCustomSelect.settings,c),null===e&&(e=a.fn.flyweightCustomSelect.menu=new f,a(window).bind("resize",e.reposition),a(document).bind(b,h)),this.each(function(){a(this).data("placeHolder")||a(this).data("placeHolder",new g(this))})},destroy:function(){return e.destroy(),e=a.fn.flyweightCustomSelect.menu=null,a(document).unbind(b),a(document).unbind("touchmove"),a(document).unbind("touchstart"),this.each(function(){a(this).data("placeHolder").destroy(),a(this).data("placeHolder",null)})},enable:function(){return this.each(function(){a(this).data("placeHolder").enable()})},disable:function(){return this.each(function(){a(this).data("placeHolder").disable()})}},i=function(){return a.browser.msie&&parseInt(a.browser.version,10)<7?function(b){return a('<div class="'+d.classes.placeholder.container.base+" "+b.className+'"><a href="#" aria-owns="'+b.id+'" role="button" href="#" aria-haspopup="true" id="'+b.id+'-button"><span class="'+d.classes.placeholder.text.base+'">'+b.options[b.selectedIndex].text+'</span><span class="'+d.classes.placeholder.arrow.base+'"></span></a></div>')}:function(b){return a('<a href="#" aria-owns="'+b.id+'" class="'+d.classes.placeholder.container.base+" "+b.className+'" role="button" href="#" aria-haspopup="true" id="'+b.id+'-button"><span class="'+d.classes.placeholder.text.base+'">'+b.options[b.selectedIndex].text+'</span><span class="'+d.classes.placeholder.arrow.base+'"></span></a>')}}();return h[c]?h[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?(a.error("Method "+c+" does not exist on jQuery.flyweightCustomSelect"),void 0):h.init.apply(this,arguments)},a.fn.flyweightCustomSelect.settings={alignTo:null,classes:{placeholder:{container:{base:"fwselect",open:"fwselect-open",dropdown:"fwselect-drop-down",dropup:"fwselect-drop-up",focus:"fwselect-focus",disabled:"fwselect-disabled"},text:{base:"fwselect-text"},arrow:{base:"fwselect-arrow"}},menu:{container:{base:"fwselect-menu",open:"fwselect-menu-open",dropdown:"fwselect-menu-drop-down",dropup:"fwselect-menu-drop-up"},list:{base:"fwselect-menu-list"},listitem:{base:"fwselect-menu-listitem",focus:"fwselect-menu-listitem-focus"},group:{base:"fwselect-menu-group"},scroll:{base:"fwselect-menu-scroll"}}},optionfilter:"option,optgroup",tabindex:!1,keymap:{left:37,right:39,up:38,down:40,enter:13,space:32,tab:9,pgup:33,pgdn:34,escape:27}}}(jQuery);